# コンパイル

前の項目で書いたコードを覚えているだろうか。いや、忘れてしまっていても全く問題はない。筆者ほどになるとあの程度のプログラムならば3秒あればかけてしまう。思い出すために５秒かけて前の項目とここを往復する必要はない。
前の項目で書いたコードは以下の通りだった。

```C
int main(void){}
```

ところで、開発環境はインストールされているだろうか。[01 最小のプログラム](01_minimum-program.md)でインストールするよう話したにもかかわらず未だに何もしていないならばすぐにしたほうが良い。

では、早速コンパイルしてみよう。まずは先ほどのコードを適当な名前を付けてディスクに保存しよう。著者は`minimum.c`と名前を付けることにする。コードを保存した場所に移動できるだろうか。Linuxユーザーならば端末でcdコマンドを使ってディレクトリを移動しよう。Windowsユーザーならば、エクスプローラーでファイルの場所を開いてからアドレスバーに`cmd`と打ち込めばその場所でコマンドプロンプトが開く。

ファイルの場所をコンソールで開けたならばコンパイルすることができる。GCCユーザーは以下のように入力しよう。

```
gcc minimum.c
```

clangユーザーは`gcc`の代わりに`clang`を使う。自分がどちらのコンパイラを使っているか分からないLinuxユーザーは`cc`コマンドでおそらく`gcc`が実行される。Windowsユーザーでどのコンパイラを使っているか分からないものは自分が何を使っているのか調べると良い。

何も表示されずに次のコマンドの入力待ちになったらコンパイルには成功している。先ほどの例通りにコンパイルしたならばおそらく今いるディレクトリに`a.out`か`a.exe`というファイルができているはずだ。ディレクトリの中身を表示するにはLinuxユーザーは`ls`、Windowsユーザーは`dir`コマンドを使う。ファイルが問題なく存在していれば`./a.out`か`.\a.exe`と入力して初めて作った自分のプログラムを実行しよう。きっと何も起こらないはずだ。

さて、読者はコンパイルに成功した。これは素晴らしいことだ。もうほとんどC言語をマスターしかけている。自分で書いたコードが一発でコンパイルを通ることなんてそうそうない。これはレアなケースだ。プログラミングを始めてすぐにそういう状況に巡り合えた読者は運がいい。これからも誇っていくといいだろう。

## コンパイルエラー

先ほどちらっと話したように、コンパイルは失敗する場合がある。コンパイルが通るソースコードのことをwell-formedと言うのとは対照的にコンパイルに失敗するソースコードはill-formedと呼ばれる。コンパイルに失敗する原因は主に二つだ。

1. 文法エラー
2. 意味エラー

実はコンパイラのバグなんていう闇の深い事象もごくまれに観測されるが、きちんとしたコンパイラを使っているならばほとんどの読者は一生のうち1回巡り合うかどうかだ。


### 文法エラー

ここで一度コンパイルエラーを経験してみよう。初めに文法エラーというものを見てみる。文法エラーとはCの文法に基づいていないためにおこるエラーのことだ。

```
int main(void){ return }
```

上のようなコードを保存してclangでコンパイルしてみたところ下のようなエラーメッセージが表示された。文法エラーなのでメッセージの内容はごく単純で且つ的を射ていることが多い。文法エラーの場合はまずしっかりとエラーを読んで何が悪かったのか認識するべきだ。

```
ill-formed.c:1:24: error: expected expression
int main(void){ return }
                       ^
1 error generated.
```

clangによると`ill-formed.c`の1行目の24列にエラーがあるようだ。なるほど、`return`の後に`式`が必要なんだな。全くもってその通りだ。clang様の言う通りでございます。すぐに直しますのでそのまましばらくお待ちください。この場合は`return`の後に式を書けばコンパイルエラーは解消される。`return 0;`が最も的確だろう。

文法エラーの場合はエラーの起きている場所の周辺のコードを読むことが大事だ。

### 意味エラー

次に意味エラーについて見ていこう。意味エラーとは文法的には正しいが、意味が間違っているエラーのことだ。

```C
int main(void){ return (void)0; }
```

上のコードは戻り値が`int`型の`main`関数内で明示的に何も返していないため、文法的には正しいにもかかわらずエラーになる。
コンパイルエラーは以下の通りだ。

```
.\ill-formed2.c:2:24: error: returning 'void' from a function with incompatible result type 'int'
int main(void){ return (void)0; }
                       ^~~~~~~
1 error generated.
```

このような簡単な意味エラーの場合コンパイラはきちんとエラーの内容を報告してくれる。「`int`型の戻り値が要るけど、なにも返していないよ！」ということらしい。`(void)`を消去すればコンパイルは通るようになる。

ソースコードが複雑になればエラーも複雑になる。まだエラーメッセージが理解可能な間にエラーの解決法を習得しておくと良い。
